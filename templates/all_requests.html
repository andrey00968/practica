<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Все Заявки</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
<header>
    <style>
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    tr:nth-child(even) {
        background-color: #000;
        color: #fff;
    }
    tr:nth-child(odd) {
        background-color: #323232;
        color: #fff;
    }
    th {
        background-color: #052afa;
        color: white;
    }
    th:nth-child(1), td:nth-child(1) {
        width: 10%;
    }
    th:nth-child(2), td:nth-child(2) {
        width: 50%;
    }
    th:nth-child(3), td:nth-child(3) {
        width: 20%;
    }
    th:nth-child(4), td:nth-child(4) {
        width: 20%;
    }
</style>
    <div class="logo">
        <a href="{{ url_for('index') }}">СборкаКомпьютеров</a>
    </div>
    <nav>
        {% if user %}
            {% if user.admin == 1 %}
                <button class="account-btn" onclick="location.href='{{ url_for('all_requests') }}'">Все заявки</button>
            {% else %}
                <button class="account-btn" onclick="location.href='{{ url_for('my_requests') }}'">Мои заявки</button>
            {% endif %}
        {% else %}
            <button class="account-btn" onclick="location.href='{{ url_for('personal_account') }}'">Личный кабинет</button>
        {% endif %}
    </nav>
</header>

<main>
    <table>
        <tr>
            <th>Номер заявки</th>
            <th>Текст заявки</th>
            <th>Пользователь</th>
            <th>Статус заявки</th>
        </tr>
        {% for zayavka in zayavki %}
<tr>
    <td>{{ zayavka[0] }}</td>
    <td>{{ zayavka[1] }}</td>
    <td>{{ zayavka[2] }}</td>
    <td>
        <input type="checkbox" class="status-checkbox" data-number="{{ zayavka[0] }}" data-status="1" {% if '1' in zayavka[3] %}checked{% endif %}> Принята
        <input type="checkbox" class="status-checkbox" data-number="{{ zayavka[0] }}" data-status="2" {% if '2' in zayavka[3] %}checked{% endif %}> Выполнена
        <input type="checkbox" class="status-checkbox" data-number="{{ zayavka[0] }}" data-status="3" {% if '3' in zayavka[3] %}checked{% endif %}> Отклонена
        <button class="apply-btn" data-number="{{ zayavka[0] }}" data-username="{{ zayavka[2] }}">Применить</button>
    </td>
</tr>
{% endfor %}
    </table>
</main>

<script>
    document.addEventListener("DOMContentLoaded", function() {
    const applyButtons = document.querySelectorAll('.apply-btn');
    applyButtons.forEach(button => {
        button.addEventListener('click', function() {
            const number = this.dataset.number;
            const username = this.dataset.username;
            const checkboxes = document.querySelectorAll(`.status-checkbox[data-number="${number}"]`);
            const statuses = [];
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    statuses.push(checkbox.dataset.status);
                }
            });
            fetch('/update_status', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ number, statuses, username })
            }).then(response => {
                if (response.ok) {
                    console.log('Status updated successfully');
                } else {
                    console.error('Failed to update status');
                }
            });
        });
    });
});
</script>
</body>
</html>
